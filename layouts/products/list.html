{{ define "main" }}
<section class="section">
  <div class="container">
    <h1 class="text-center">{{ .Title }}</h1>
    <div id="product-list" class="row"></div>
  </div>
</section>

<script src="{{ "js/products.js" | absURL }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const productList = document.getElementById('product-list');
    const products = await getProducts();

    if (products) {
      products.forEach(product => {
        let variantSelectors = '';
        if (product.variants) {
          product.variants.forEach(variant => {
            variantSelectors += getVariantSelector(variant);
          });
        }

        const productCard = `
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100">
              <a href="#"><img class="card-img-top" src="${product.images && product.images.length > 0 ? product.images[0].url : 'https://via.placeholder.com/700x400'}" alt=""></a>
              <div class="card-body">
                <h4 class="card-title">
                  <a href="#">${product.name.replace(/[-_]/g, ' ')} (${product.sku})</a>
                </h4>
                <h5>$${Math.round(product.price)}</h5>
                <p class="card-text">${product.description}</p>
                <div>
                  <p>Category: ${product.categories.map(c => c.name).join(', ')}</p>
                  <p>Quantity: ${product.stock_real}</p>
                </div>
                ${variantSelectors}
              </div>
              <div class="card-footer">
                <small class="text-muted">&#9733; &#9733; &#9733; &#9733; &#9734;</small>
              </div>
            </div>
          </div>
        `;
        productList.innerHTML += productCard;
      });
    }
  });
</script>
{{ end }}
