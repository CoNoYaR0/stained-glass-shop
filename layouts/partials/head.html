<head>
  <meta charset="utf-8">
  <title>{{ .Title }}</title>

  {{ "<!-- mobile responsive meta -->" | safeHTML }}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with site.Params.description }}{{ . }}{{ end }}{{ end }}">
  {{ with site.Params.author }}<meta name="author" content="{{ . }}">{{ end }}
  {{ hugo.Generator }}
  
  <!-- theme meta -->
  <meta name="theme-name" content="vex-hugo" />

  {{ "<!-- plugins -->" | safeHTML }}
  {{ range site.Params.plugins.css }}
  <link rel="stylesheet" href="{{ .link | absURL }} ">
  {{ end }}

  {{ "<!-- Main Stylesheet -->" | safeHTML }}
  {{ $scssPathKey := "scss/style.scss" }}
  {{ $scssOptions := (dict "outputStyle" "compressed") }}
  {{ $stylesheet := "" }} {{/* Initialize */}}

  {{ $initialResourceAttempt := resources.Get $scssPathKey }}
  {{ $actualResource := "" }} {{/* Initialize */}}
  {{ $debugInitialType := printf "%T" $initialResourceAttempt }}

  {{ if eq $debugInitialType "string" }}
    {{ warnf "DEBUG head.html: Initial attempt for '%s' returned a STRING: '%s'. Attempting to re-get using this string as path." $scssPathKey $initialResourceAttempt }}
    {{ $actualResource = resources.Get $initialResourceAttempt }}
  {{ else }}
    {{ $actualResource = $initialResourceAttempt }}
  {{ end }}

  {{/* --- DEBUGGING BLOCK for $actualResource --- */}}
  {{ if $actualResource }}
    {{ warnf "DEBUG head.html: $actualResource after re-get logic. Name: %s, Type: %T, MediaType: %s, Content Length: %d" $actualResource.Name (printf "%T" $actualResource) $actualResource.MediaType (len $actualResource.Content) }}
    {{ warnf "DEBUG head.html: $actualResource.Permalink: %s" $actualResource.Permalink }}
    {{ warnf "DEBUG head.html: $actualResource.RelPermalink: %s" $actualResource.RelPermalink }}
  {{ else }}
    {{ warnf "DEBUG head.html: $actualResource for '%s' is NIL (Initial type was: %s)." $scssPathKey $debugInitialType }}
  {{ end }}
  {{/* --- DEBUGGING BLOCK END --- */}}


  {{ if $actualResource }}
    {{ if ne $actualResource.Content "" }}
      {{/* Ensure $actualResource is truly a resource object that resources.Sass can handle */}}
      {{ if not (eq (printf "%T" $actualResource) "string") }}
        {{ $processedStyles := resources.Sass $actualResource $scssOptions }}
        {{ $stylesheet = $processedStyles }}
        <link rel="stylesheet" href="{{ $stylesheet.Permalink }}" media="screen">
      {{ else }}
        {{ warnf "ERROR head.html: $actualResource is STILL a string ('%s') after re-get logic. Cannot process with resources.Sass." $actualResource }}
      {{ end }}
    {{ else }}
      {{ warnf "SCSS resource %s is empty. (Content check on $actualResource)" $scssPathKey }}
    {{ end }}
  {{ else }}
    {{ warnf "SCSS resource %s not found. (Resource check on $actualResource)" $scssPathKey }}
  {{ end }}

  {{ "<!--Favicon-->" | safeHTML }}
  <link rel="shortcut icon" href="{{ `images/favicon.png` | absURL }} " type="image/x-icon">
  <link rel="icon" href="{{ `images/favicon.png` | absURL }} " type="image/x-icon">

  {{ with .Params.image }}
  <meta property="og:image" content="{{ . | absURL }}" />
  {{ end }}
  {{ template "_internal/opengraph.html" . }}
  {{ template "_internal/google_analytics.html" . }}

</head>
