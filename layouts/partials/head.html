<head>
  <meta charset="utf-8">
  <title>{{ .Title }}</title>

  {{ "<!-- mobile responsive meta -->" | safeHTML }}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with site.Params.description }}{{ . }}{{ end }}{{ end }}">
  {{ with site.Params.author }}<meta name="author" content="{{ . }}">{{ end }}
  {{ hugo.Generator }}
  
  <!-- theme meta -->
  <meta name="theme-name" content="vex-hugo" />

  {{ "<!-- plugins -->" | safeHTML }}
  {{ range site.Params.plugins.css }}
  <link rel="stylesheet" href="{{ .link | absURL }} ">
  {{ end }}

  {{ "<!-- Main Stylesheet -->" | safeHTML }}
  {{ $scssFilePath := "assets/scss/style.scss" }} {{/* Path relative to project root for readFile */}}
  {{ $targetResourceName := "scss/style.scss" }} {{/* Target name/path for the resource created by FromString */}}
  {{ $scssOptions := (dict "outputStyle" "compressed") }}
  {{ $stylesheet := "" }} {{/* Initialize */}}

  {{ $fileContent := "" }}
  {{ $fileExists := fileExists $scssFilePath }}

  {{ if $fileExists }}
    {{ $fileContent = readFile $scssFilePath }}
    {{ warnf "DEBUG head.html: readFile '%s' - File exists. Content Length: %d" $scssFilePath (len $fileContent) }}
  {{ else }}
    {{ warnf "DEBUG head.html: readFile '%s' - File does NOT exist." $scssFilePath }}
  {{ end }}

  {{ if and $fileExists (ne $fileContent "") }}
    {{/* Create a resource from the string content.
         The second argument to resources.FromString is the target path/name for this resource.
         It helps Hugo understand what kind of resource it is (e.g., by its .scss extension)
         and is used in internal caching. */}}
    {{ $scssResource := resources.FromString $targetResourceName $fileContent }}

    {{ if $scssResource }}
      {{ warnf "DEBUG head.html: Successfully created resource from string. Name: %s, Type: %T, MediaType: %s" $scssResource.Name (printf "%T" $scssResource) $scssResource.MediaType }}
      {{ $processedStyles := resources.Sass $scssResource $scssOptions }}
      {{ $stylesheet = $processedStyles }}
      <link rel="stylesheet" href="{{ $stylesheet.Permalink }}" media="screen">
    {{ else }}
      {{ warnf "ERROR head.html: resources.FromString for target '%s' returned NIL." $targetResourceName }}
    {{ end }}
  {{ else }}
    {{ if not $fileExists }}
      {{ warnf "SCSS file '%s' not found by readFile. Main stylesheet will be missing." $scssFilePath }}
    {{ else }}
      {{ warnf "SCSS file '%s' is empty. Main stylesheet will be missing." $scssFilePath }}
    {{ end }}
  {{ end }}

  {{ "<!--Favicon-->" | safeHTML }}
  <link rel="shortcut icon" href="{{ `images/favicon.png` | absURL }} " type="image/x-icon">
  <link rel="icon" href="{{ `images/favicon.png` | absURL }} " type="image/x-icon">

  {{ with .Params.image }}
  <meta property="og:image" content="{{ . | absURL }}" />
  {{ end }}
  {{ template "_internal/opengraph.html" . }}
  {{ template "_internal/google_analytics.html" . }}

</head>
